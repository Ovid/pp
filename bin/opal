#!/usr/bin/env node

import * as fs from 'fs';
import * as path from 'path';
import { fileURLToPath } from 'url';

// Get the directory name of the current module
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Construct an absolute path to Opal.js
const opalPath = path.resolve(__dirname, '../js/src/Opal.js');

// Import Opal using the absolute path
const { Opal } = await import(opalPath);

const file = process.argv[2];

if (!file) {
    console.error('Please provide a file to run.');
    process.exit(1);
}

fs.readFile(file, 'utf8', (err, data) => {
    if (err) {
        console.error(`Error reading file: ${err.message}`);
        process.exit(1);
    }

    const lines = data.split('\n');
    if (lines[0].startsWith('#!')) {
        lines.shift();
    }

    const opal = new Opal({ quiet: true });
    opal.run(lines);
});
